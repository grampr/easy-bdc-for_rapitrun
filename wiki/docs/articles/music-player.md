---
slug: music-player
title: 音楽プレイヤー
subtitle: Tutorial 5
description: ボイスチャンネル参加、音楽ファイル再生/停止の基本。FFmpeg 設定と権限チェックのポイント付き。
updated: 2025-12-02
tags: [voice, audio, commands]
accent: amber
order: 5
---

# Tutorial 5: 音楽プレイヤー

ボイスチャンネル参加と音源再生/停止を行うシンプルな音楽 Bot の作り方です。

## 前提

- 実行環境に FFmpeg がインストール済みでパスが通っていること。
- Bot に「ボイスチャンネルへ接続」「発言」権限が付与されていること。
- 音源ファイルはサーバー上の絶対/相対パス、もしくはストリーミング URL を指定可能。

## 構築手順

1. **コマンド**: プレフィックス `!play` またはスラッシュ `/play` を作成し、引数に「音源パス」を用意。
2. **VC 参加**: 「ボイスチャンネルに参加」ブロックを最初に配置。呼び出しユーザーが VC に居るときのみ成功。
3. **再生**: 「音楽ファイルを再生」ブロックに引数を接続。URL/パスをそのまま渡せる。
4. **停止**: 別コマンド `/stop` または `!stop` を用意し、「ボイスチャンネルから退出」を実行。
5. **状態メッセージ**: 再生開始・停止時に「返信する」で曲名/パスを表示するとユーザーに親切。

> 簡単なガード例:  
> `if not user.voice` → 「先に VC に参加してから実行してね」メッセージを送信。  
> 二重再生を防ぐ場合は `if ctx.guild.voice_client.is_playing():` で条件分岐。

## チェックポイント

- FFmpeg 実行ファイルにパスが通っているか。Windows なら `where ffmpeg`、Mac/Linux なら `which ffmpeg` で確認。
- 複数サーバーで使う場合は接続・切断の前後に `await wait_seconds` を入れると安定しやすい。
- 音源 URL が再生できない場合は https かつ直接音声を返す URL かを確認。YouTube は別ライブラリが必要。
