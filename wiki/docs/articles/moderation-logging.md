---
slug: moderation-logging
title: モデレーションログとロール付与をブロックで組む
subtitle: Tutorial 4
description: EDBB のイベント・ロール・Kick/BAN ブロックで簡単な管理機能を作り、Embed ログを飛ばす流れをまとめました。env なしで ID を直書きする想定です。
updated: 2025-12-02
tags: [moderation, logs, roles]
accent: emerald
order: 4
---

# Tutorial 4: モデレーションログとロール付与をブロックで組む

チャット監視・リアクションロール・Kick/BAN のような「運営寄りの機能」を、EDBB のブロックだけで組んでみます。値の受け渡しはシンプルで、ID はそのまま文字列で入れる想定です。

## ゴール

- NG メッセージを消してログ Embed を送る
- 特定メッセージへのリアクションでロールを付与する
- Kick / BAN / タイムアウトを走らせたらログを飛ばす

## Step 1: NG ワードを消してログを送る

1. 「📩 メッセージを受信したとき」を配置。  
2. 「条件 (if)」ブロックで `受信したメッセージの内容` に NG ワードが含まれるかを判定。  
   - シンプルにやるなら「🐍 Pythonコード実行」で `if "spam" in ctx.content.lower():` のように書くのが早いです（`ctx` にはメッセージが入っています）。  
3. 条件内に「🗑️ このメッセージを削除」を置く。  
4. 同じ条件内で「✨ 新しい埋め込み(Embed)作成」→「設定：タイトル/説明/色」→「項目名/内容を追加」で `ユーザー` と `チャンネル` を埋める。  
5. 「#️⃣ チャンネルID に送信」でログ用チャンネル ID を直書きし、Embed を送る。

## Step 2: リアクションでロール付与

1. 「⭐ リアクションが付いたとき」を追加し、対象メッセージ ID と絵文字（例: ✅）を入力。  
2. 中で「➕ ロール付与 (ユーザーID / ロールID)」を繋ぎ、付与したいロール ID を入れる。  
   - ロール剥奪のブロックもあるので、別メッセージや別絵文字で組み合わせてもOK。

※ リアクションの削除イベントはブロックに無いので、「付けたら付与する」片方向の設計になります。

## Step 3: Kick / BAN / タイムアウト + ログ

1. 「🗣️ プレフィックスコマンド」を `!kick` や `!ban` に設定（理由は入力ブロックが無いので固定文で）。  
2. コマンド内に「Kick/BAN/タイムアウト」ブロックを置き、対象のユーザー ID を手入力するか、必要なら「🐍 Pythonコード実行」で `target_id = ctx.author.id` など柔軟に取得。  
3. その直後に「✨ 埋め込み作成」→「項目名/内容を追加」で対象ユーザーや理由をまとめ、ログチャンネルへ送信。

## 運用メモ

- `member_has_role` を if 条件に挟んで、モデレーターだけが実行できるようにしておくと安全です（ロール ID は文字列で渡す）。  
- ログ Embed はジャンプリンクを入れると後から追いやすいですが、ブロックにリンク生成が無いので必要なら「🐍 Pythonコード実行」で `ctx.jump_url` を使ってください。  
- 生成コードの Intents は `message_content` / `members` を有効化済みです。Developer Portal でも同じ Intents をオンにしておくと検知漏れが減ります。

これで管理系の最低限が揃いました。次は音声再生ブロックで遊んでみます。
